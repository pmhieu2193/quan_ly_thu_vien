<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω s√°ch</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #333; }
    input, button { padding: 8px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
  </style>
</head>
<body>
  <h2>üìö Th√™m s√°ch m·ªõi</h2>
  <form id="addBookForm">
    <input type="text" id="TenSach" placeholder="T√™n s√°ch" required />
    <input type="text" id="TacGia" placeholder="T√°c gi·∫£" />
    <input type="number" id="NamXuatBan" placeholder="NƒÉm xu·∫•t b·∫£n" />
    <input type="number" id="TriGia" placeholder="Tr·ªã gi√°" />
    <input type="text" id="img" placeholder="Link ·∫£nh" />
    <input type="text" id="NhaXuatBan" placeholder="Nh√† xu·∫•t b·∫£n" />
    <input type="text" id="MoTa" placeholder="M√¥ t·∫£" />
    <input type="number" id="MaTL" placeholder="M√£ th·ªÉ lo·∫°i" />
    <button type="submit">‚ûï Th√™m s√°ch</button>
  </form>

  <h2>üîç T√¨m ki·∫øm s√°ch</h2>
  <input type="text" id="searchTenSach" placeholder="Nh·∫≠p t√™n s√°ch c·∫ßn t√¨m..." />
  <button onclick="searchBooks()">T√¨m</button>
  <button onclick="loadAllBooks()">Hi·ªÉn th·ªã t·∫•t c·∫£</button>

  <h2>üìñ Danh s√°ch s√°ch</h2>
  <table id="booksTable">
    <thead>
      <tr>
        <th>M√£</th>
        <th>T√™n</th>
        <th>T√°c gi·∫£</th>
        <th>NƒÉm</th>
        <th>Tr·ªã gi√°</th>
        <th>NXB</th>
        <th>M√¥ t·∫£</th>
        <th>·∫¢nh</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = 'http://localhost:3000/books'; // C·∫≠p nh·∫≠t n·∫øu port kh√°c

    document.getElementById('addBookForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const book = {
        TenSach: document.getElementById('TenSach').value,
        TacGia: document.getElementById('TacGia').value,
        NamXuatBan: document.getElementById('NamXuatBan').value,
        TriGia: document.getElementById('TriGia').value,
        img: document.getElementById('img').value,
        NhaXuatBan: document.getElementById('NhaXuatBan').value,
        MoTa: document.getElementById('MoTa').value,
        MaTL: document.getElementById('MaTL').value,
      };
      try {
        const res = await fetch(API_BASE, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(book)
        });
        if (res.ok) {
          alert('‚úÖ ƒê√£ th√™m s√°ch!');
          e.target.reset();
          loadAllBooks();
        } else {
          alert('‚ùå Th√™m s√°ch th·∫•t b·∫°i');
        }
      } catch (err) {
        console.error(err);
        alert('‚ùå L·ªói k·∫øt n·ªëi server');
      }
    });

    async function loadAllBooks() {
      try {
        const res = await fetch(API_BASE);
        const books = await res.json();
        renderBooks(books);
      } catch (err) {
        console.error('Error loading books:', err);
      }
    }

    async function searchBooks() {
      const keyword = document.getElementById('searchTenSach').value;
      try {
        const res = await fetch(`${API_BASE}?TenSach=${encodeURIComponent(keyword)}`);
        const books = await res.json();
        renderBooks(books);
      } catch (err) {
        console.error('Error searching books:', err);
      }
    }

    function renderBooks(books) {
      const tbody = document.querySelector('#booksTable tbody');
      tbody.innerHTML = '';
      books.forEach(book => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${book.MaSach}</td>
          <td>${book.TenSach}</td>
          <td>${book.TacGia || ''}</td>
          <td>${book.NamXuatBan || ''}</td>
          <td>${book.TriGia || ''}</td>
          <td>${book.NhaXuatBan || ''}</td>
          <td>${book.MoTa || ''}</td>
          <td>${book.img ? `<img src="${book.img}" width="50"/>` : ''}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // T·∫£i danh s√°ch khi m·ªü trang
    loadAllBooks();
  </script>
</body>
</html>
